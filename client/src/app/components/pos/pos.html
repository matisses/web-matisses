<div id="modalAutorizacion" class="modal fade" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <form #AuthorizationForm="ngForm" (submit)="abrirCaja(true, AuthorizationForm)">
          <div class="row" *ngIf="mensajeError && mensajeError.length > 0">
            <div class="col-xs-12">
              <div class="alert alert-danger" role="alert">{{mensajeError}}</div>
            </div>
          </div>
          <div class="row">
            <div class="col-xs-12 margin-bottom-10">
              <label for="usuarioAutoriza">Usuario:</label>
              <input id="usuarioAutoriza" type="text" class="form-control input-lg" name="usuarioAutoriza" [(ngModel)]="usuarioAutoriza" [class.required-field]="!valid" required>
            </div>
          </div>
          <div class="row">
            <div class="col-xs-12">
              <label for="passwordAutoriza">Contraseña:</label>
              <input id="passwordAutoriza" type="password" class="form-control input-lg" name="passwordAutoriza" [(ngModel)]="claveAutoriza" [class.required-field]="!valid" required (keyup.enter)="abrirCaja(true, AuthorizationForm)">
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default btn-lg" (click)="cerrarModalValidarPermisoAutorizacion(AuthorizationForm)">Cerrar</button>
        <button type="button" class="btn btn-primary btn-lg" (click)="abrirCaja(true, AuthorizationForm)">Autorizar</button>
      </div>
    </div>
  </div>
</div>

<div id="modalCaja" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Apertura de caja</h4>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-xs-12">
            <div class="row">
              <div class="col-xs-8">
                <div class="row">
                  <div class="col-xs-4 text-center margin-bottom-10" *ngFor="let denominacion of denominaciones" (click)="seleccionarDenominacion(denominacion.id)">
                    <img class="img-dinero" [ngClass]="denominacion.clase" src="{{denominacion.urlImagen}}" alt="{{denominacion.valor}}">
                    <p class="valor-dinero">
                      $ {{(denominacion.valor * denominacion.cantidad) | number}}
                    </p>
                  </div>
                </div>
              </div>
              <div class="col-xs-4">
                <div class="row">
                  <div class="col-xs-12">
                    <input class="form-control input-lg text-right input-calculadora" type="number" name="valor" [(ngModel)]="cantidad" disabled>
                  </div>
                </div>
                <br/>
                <div class="row">
                  <div class="col-xs-12">
                    <div>
                      <button class="contenedor-calculadora width-contenedor-calculadora" (click)="agregarCantidadDenominacion(7)">7</button>
                      <button class="contenedor-calculadora width-contenedor-calculadora" (click)="agregarCantidadDenominacion(8)">8</button>
                      <button class="contenedor-calculadora width-contenedor-calculadora" (click)="agregarCantidadDenominacion(9)">9</button>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-xs-12">
                    <div>
                      <button class="contenedor-calculadora width-contenedor-calculadora" (click)="agregarCantidadDenominacion(4)">4</button>
                      <button class="contenedor-calculadora width-contenedor-calculadora" (click)="agregarCantidadDenominacion(5)">5</button>
                      <button class="contenedor-calculadora width-contenedor-calculadora" (click)="agregarCantidadDenominacion(6)">6</button>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-xs-12">
                    <div>
                      <button class="contenedor-calculadora width-contenedor-calculadora" (click)="agregarCantidadDenominacion(1)">1</button>
                      <button class="contenedor-calculadora width-contenedor-calculadora" (click)="agregarCantidadDenominacion(2)">2</button>
                      <button class="contenedor-calculadora width-contenedor-calculadora" (click)="agregarCantidadDenominacion(3)">3</button>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-xs-12">
                    <div>
                      <button class="contenedor-calculadora width-contenedor-calculadora-cero" (click)="agregarCantidadDenominacion(0)">0</button>
                      <button class="contenedor-calculadora width-contenedor-calculadora" (click)="quitarCantidadDenominacion()">C</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <div class="row">
          <div class="col-xs-6 text-left">
            <p class="total-caja">
              Total: $ {{totalCaja | number}}
            </p>
          </div>
          <div class="col-xs-6" *ngIf="totalCaja >= 400000">
            <button class="btn btn-primary btn-lg" type="button" (click)="ejecutarAperturaCaja()">Abrir</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="modalTarjetas" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Pagos con tarjeta</h4>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-xs-3">
            <div class="row">
              <div class="col-xs-12 margin-bottom-10">
                <div class="text-center pointer-cursor contenedor-medio-pago" [ngClass]="{'contenedor-medio-pago-activo' : tipoPagoTarjeta === 1}" (click)="seleccionarTipoPagoTarjeta(1)">
                  <p>Automático</p>
                </div>
              </div>
              <div class="col-xs-12 margin-bottom-10">
                <div class="text-center pointer-cursor contenedor-medio-pago" [ngClass]="{'contenedor-medio-pago-activo' : tipoPagoTarjeta === 2}" (click)="seleccionarTipoPagoTarjeta(2)">
                  <p>Manual</p>
                </div>
              </div>
              <div class="col-xs-12 margin-bottom-10">
                <div class="text-center pointer-cursor contenedor-medio-pago" [ngClass]="{'contenedor-medio-pago-activo' : tipoPagoTarjeta === 3}" (click)="seleccionarTipoPagoTarjeta(3)">
                  <p>Ayuda datáfono</p>
                </div>
              </div>
            </div>
          </div>
          <div class="col-xs-9">
            <div class="row" *ngIf="tipoPagoTarjeta && tipoPagoTarjeta === 2">
              <div class="col-xs-12">
                <div class="row">
                  <div class="col-xs-12">
                    <h3>Franquicias</h3>
                  </div>
                  <div class="col-xs-3 text-center margin-bottom-10" *ngFor="let franquicia of franquicias">
                    <div class="img-dinero" [ngClass]="{'img-dinero-activo' : (franquiciaSeleccionada && franquicia.creditCardId === franquiciaSeleccionada.creditCardId)}" (click)="seleccionarFranquicia(franquicia)">
                      <img class="img-franquicia pointer-cursor" src="https://img.matisses.co/360/POS/Franquicias/{{franquicia.franchiseName}}.jpg" alt="{{franquicia.franchiseName}}">
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-xs-12">
                    <h3>Datos pago</h3>
                  </div>
                  <form>
                    <div class="col-xs-3">
                      <label for="digitos">Últimos dígitos</label>
                      <input id="digitos" type="number" class="form-control input-lg text-center" name="Digitos" [(ngModel)]="ultimosDigitos">
                    </div>
                    <div class="col-xs-3">
                      <label for="digitos"># voucher</label>
                      <input id="voucher" type="number" class="form-control input-lg text-center" name="Voucher" [(ngModel)]="voucher">
                    </div>
                    <div class="col-xs-6">
                      <label for="digitos">Valor</label>
                      <div class="input-group">
                        <span class="input-group-addon input-efectivo">$</span>
                        <input id="valor" type="number" class="form-control input-lg text-right" name="valor" [(ngModel)]="valorTarjeta">
                        <span class="input-group-btn">
                          <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-magnet"></span></button>
                        </span>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <div class="row" *ngIf="mensajeError && mensajeError.length > 0">
          <div class="col-xs-12 text-left">
            <div class="alert alert-danger" role="alert">{{mensajeError}}</div>
          </div>
        </div>
        <button type="button" class="btn btn-default btn-lg" data-dismiss="modal">Cerrar</button>
        <button type="button" class="btn btn-primary btn-lg" (click)="agregarPagoTarjeta()">Guardar</button>
      </div>
    </div>
  </div>
</div>

<div class="jumbotron" *ngIf="!cajaAbierta">
  <h1>¡Hola {{nombreUsuario}}!</h1>
  <p>{{mensajeInicio}}</p>
  <p *ngIf="permitirAbrirCaja">
    <a class="btn btn-primary btn-lg" role="button" (click)="abrirCaja(false)">Abrir caja</a>
  </p>
</div>
<div *ngIf="cajaAbierta">
  <div class="container-fluid contenedor">
    <div class="row">
      <div class="col-xs-8">
        <div class="row">
          <div class="col-xs-10 input-referencia margin-bottom-10">
            <form (submit)="agregarItem()">
              <input id="referencia" type="text" class="form-control input-lg" name="referencia" placeholder="Referencia a agregar" [(ngModel)]="referencia" autofocus>
            </form>
          </div>
          <div class="col-xs-2 margin-top-15">
            <div class="row">
              <div class="col-xs-6 text-center"><span class="glyphicon glyphicon-th-large iconos-items"></span></div>
              <div class="col-xs-6 text-center"><span class="glyphicon glyphicon-gift iconos-items"></span></div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-12">
            <table class="table table-bordered" style="margin-bottom: -1px !important;">
              <tr class="header-table-products">
                <th style="width: 120px"></th>
                <th class="text-center" style="width: 80px">Ref</th>
                <th class="text-center">Descripción</th>
                <th class="text-center" style="width: 55px">Cant</th>
                <th class="text-center" style="width: 115px">Precio</th>
                <th class="text-center" style="width: 115px">Subtotal</th>
              </tr>
            </table>
            <div class="nano">
              <div class="nano-content">
                <table class="table table-striped table-bordered table-hover">
                  <tr class="pointer-cursor" *ngFor="let item of items">
                    <td class="text-center" style="width: 120px"><img style="max-width: 100%" src="https://img.matisses.co/{{item.itemCode}}/mini/{{item.itemCode}}_01.jpg" alt="{{item.itemCode}}"></td>
                    <td class="text-center" style="width: 80px">{{item.shortItemCode}}</td>
                    <td>
                      {{item.itemName}}
                      <p>{{item.providerCode}}</p>
                    </td>
                    <td class="text-center" style="width: 55px">{{item.cantidad}}</td>
                    <td class="text-right" style="width: 115px">
                      <p [ngClass]="{'producto-descuento' : item.discountPercent > 0}">
                        $ {{item.price | number}}
                      </p>
                      <p *ngIf="item.discountPercent > 0">
                        $ {{((item.price / 100) * item.discountPercent) | number}}
                      </p>
                      <div class="tag-descuentos" *ngIf="item.discountPercent > 0">
                        <p style="margin: 0 !important; font-size: 12px">-{{item.discountPercent}}%</p>
                      </div>
                    </td>
                    <td class="text-right" style="width: 115px">
                      <p [ngClass]="{'producto-descuento' : item.discountPercent > 0}">
                        $ {{(item.price * item.cantidad) | number}}
                      </p>
                      <p *ngIf="item.discountPercent > 0">
                        $ {{(((item.price * item.cantidad) / 100) * item.discountPercent) | number}}
                      </p>
                    </td>
                  </tr>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-xs-4 input-cliente">
        <div class="datos-pago">
          <div class="row">
            <div class="col-xs-12">
              <div class="input-group">
                <input class="form-control input-lg" type="text" name="Documento" placeholder="Documento cliente">
                <span class="input-group-btn">
                  <button type="button" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-search"></span></button>
                </span>
              </div>
            </div>
          </div>
          <hr>
          <div class="row">
            <div class="col-xs-12 text-center">
              <h3 class="h3-pagos">Pagos</h3>
            </div>
          </div>
          <div class="row">
            <div class="col-xs-6 margin-bottom-10">
              <div class="text-center contenedor-medio-pago pointer-cursor" [ngClass]="{'contenedor-medio-pago-activo' : medioPago === 1}" (click)="seleccionarMedioPago(1)">
                Efectivo
              </div>
            </div>
            <div class="col-xs-6 text-right">
              <p class="contenedor-total-medio-pago">$ {{valorEfectivo | number}}</p>
            </div>
          </div>
          <div class="row">
            <div class="col-xs-12 ">
              <div class="valor-oculto" [ngClass]="{'valor-visible' : medioPago === 1}">
                <div class="input-group">
                  <span class="input-group-addon input-efectivo">Valor: $</span>
                  <input id="efectivo" type="number" class="form-control input-lg text-right" [(ngModel)]="valorEfectivo">
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-xs-6 margin-bottom-10">
              <div class="text-center contenedor-medio-pago pointer-cursor" [ngClass]="{'contenedor-medio-pago-activo' : (medioPago === 3)}" (click)="seleccionarMedioPago(3)">
                Tarjeta
              </div>
            </div>
            <div class="col-xs-6 text-right">
              <p class="contenedor-total-medio-pago">$ {{valorTotalTarjetas | number}}</p>
            </div>
          </div>
          <div class="row">
            <div class="col-xs-12 ">
              <div class="valor-oculto" [ngClass]="{'valor-visible' : (medioPago === 3)}">
                <table class="table table-striped table-bordered">
                  <tr>
                    <th class="text-center">#</th>
                    <th class="text-center">Franquicia</th>
                    <th class="text-center">Voucher</th>
                    <th class="text-center">Dígitos</th>
                    <th class="text-center">Total</th>
                  </tr>
                  <tr *ngFor="let pago of pagosTarjeta; let i = index">
                    <td class="text-center">{{i + 1}}</td>
                    <td class="text-center">{{pago.franquicia}}</td>
                    <td class="text-center">{{pago.voucher}}</td>
                    <td class="text-center">{{pago.tarjeta}}</td>
                    <td class="text-right">$ {{pago.valor | number}}</td>
                  </tr>
                </table>

                <button class="btn btn-primary btn-lg btn-full" type="button" data-toggle="modal" data-target="#modalTarjetas">
                  Agregar
                </button>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-xs-6 margin-bottom-10">
              <div class="text-center contenedor-medio-pago pointer-cursor" (click)="seleccionarMedioPago(5)">
                Cruce
              </div>
            </div>
            <div class="col-xs-6 text-right">
              <p class="contenedor-total-medio-pago">$ </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="navbar navbar-fixed-bottom" *ngIf="cajaAbierta">
    <div class="container-fluid">
      <div class="row">
        <div class="col-xs-12">
          <div class="btn-group btn-group-lg dropup">
            <button type="button" class="btn btn-default btn-lg dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Venta
              <span class="caret"></span>
            </button>
            <ul class="dropdown-menu dropdown-menu-scroll">
              <li style="font-size: 20px"><a href="#">Anular</a></li>
              <li style="font-size: 20px"><a href="#">Suspender</a></li>
              <li style="font-size: 20px"><a href="#">Reanudar</a></li>
              <li style="font-size: 20px"><a href="#">Cancelar</a></li>
            </ul>
          </div>
          <div class="btn-group btn-group-lg dropup open">
            <button class="btn btn-default btn-lg dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Caja
              <span class="caret"></span>
            </button>
            <ul class="dropdown-menu dropdown-menu-scroll">
              <li style="font-size: 20px"><a href="#">Abrir cajón</a></li>
              <li style="font-size: 20px"><a href="#">Cerrar</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
